
    body { display: flex; font-family: Arial, sans-serif; margin: 0; }
    #users { width: 25%; border-right: 1px solid #ccc; padding: 10px; }
    #chat { width: 75%; padding: 10px; }
    #messages { height: 400px; overflow-y: scroll; border: 1px solid #ccc; margin-bottom: 10px; padding: 10px; }
    #users div { padding: 8px; border-bottom: 1px solid #ddd; cursor: pointer; }
    #users div:hover { background: #f2f2f2; }
    .self { font-weight: bold; }
  </style>
</head>
<body>
  <div id="users"></div>
  <div id="chat">
    <div id="messages"></div>
    <input id="msg" placeholder="Type message..." />
    <button onclick="sendMsg()">Send</button>
    <input type="file" id="fileInput" />
    <button onclick="sendFile()">Send File</button>
  </div>

<script>
  const socket = io();
  let targetId = null;

  const name = prompt("Enter your name:");
  socket.emit('register', name);

  socket.on('userList', (users) => {
    const usersDiv = document.getElementById('users');
    usersDiv.innerHTML = '';
    for (let id in users) {
      const div = document.createElement('div');
      div.innerText = users[id] + (id === socket.id ? ' (You)' : '');
      if (id !== socket.id) div.onclick = () => targetId = id;
      usersDiv.appendChild(div);
    }
  });

  function sendMsg() {
    const msg = document.getElementById('msg').value;
    if (!targetId) return alert('Select a user first');
    socket.emit('privateMessage', { targetId, message: msg });
    document.getElementById('msg').value = '';
  }

  socket.on('privateMessage', ({ name, message }) => {
    const m = document.createElement('div');
    m.innerText = name + ': ' + message;
    document.getElementById('messages').appendChild(m);
  });

  async function sendFile() {
    if (!targetId) return alert('Select a user first');
    const fileInput = document.getElementById('fileInput');
    const formData = new FormData();
    formData.append('file', fileInput.files[0]);
    const res = await fetch('/upload', { method: 'POST', body: formData });
    const data = await res.json();
    socket.emit('privateMessage', { targetId, message: 'File: /uploads/' + data.filename });
  }
</script>
</body>
</html>
